generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String   // ADMIN, FINANCE_MANAGER, PROJECT_MANAGER
  status    String   @default("Active")
  createdAt DateTime @default(now())
  auditLogs AuditLog[]
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  action    String
  details   String?
  createdAt DateTime @default(now())
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String
  budget      Float
  actualCost  Float    @default(0)
  startDate   DateTime
  endDate     DateTime
  progress    Int      @default(0)
  status      String   // On Track, At Risk, Completed
  invoices    Invoice[]
  risks       RiskAnalysis[]
  createdAt   DateTime @default(now())
}

model Account {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  type      String   // Asset, Liability, Equity, Revenue, Expense
  balance   Float    @default(0)
  lines     JournalEntryLine[]
}

model Vendor {
  id        Int      @id @default(autoincrement())
  name      String
  email     String?
  phone     String?
  invoices  Invoice[]
  createdAt DateTime @default(now())
}

model Customer {
  id        Int      @id @default(autoincrement())
  name      String
  email     String?
  phone     String?
  createdAt DateTime @default(now())
}

model Invoice {
  id          Int      @id @default(autoincrement())
  invoiceNumber String @unique
  vendorId    Int?
  vendor      Vendor?  @relation(fields: [vendorId], references: [id])
  vendorName  String   // Keep for fallback/legacy
  amount      Float
  currency    String   @default("USD")
  issueDate   DateTime
  dueDate     DateTime
  status      String   // Pending, Paid, Overdue, Partially Paid
  projectId   Int?
  project     Project? @relation(fields: [projectId], references: [id])
  payments    Payment[]
  createdAt   DateTime @default(now())
}

model Payment {
  id        Int      @id @default(autoincrement())
  invoiceId Int
  invoice   Invoice  @relation(fields: [invoiceId], references: [id])
  amount    Float
  date      DateTime
  method    String   // Bank Transfer, Check, Cash
  reference String?
  createdAt DateTime @default(now())
}

model ExchangeRate {
  id        Int      @id @default(autoincrement())
  currency  String   @unique // e.g., "EUR"
  rateToUSD Float    // Exchange rate to base currency (USD)
  updatedAt DateTime @updatedAt
}

model JournalEntry {
  id          Int      @id @default(autoincrement())
  date        DateTime
  description String
  status      String   @default("Draft") // Draft, Approved
  lines       JournalEntryLine[]
  createdAt   DateTime @default(now())
}

model JournalEntryLine {
  id             Int          @id @default(autoincrement())
  journalEntryId Int
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id])
  accountId      Int
  account        Account      @relation(fields: [accountId], references: [id])
  debit          Float        @default(0)
  credit         Float        @default(0)
}

model RiskAnalysis {
  id          Int      @id @default(autoincrement())
  projectId   Int
  project     Project  @relation(fields: [projectId], references: [id])
  riskScore   Float
  riskLevel   String   // Low, Medium, High
  factors     String   // JSON string or comma-separated
  createdAt   DateTime @default(now())
}
